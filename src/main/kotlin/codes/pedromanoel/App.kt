/*
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package codes.pedromanoel

import com.natpryce.konfig.*
import com.natpryce.konfig.ConfigurationProperties.Companion.fromOptionalFile
import io.javalin.Javalin
import java.io.File

class App(
    private val config: Configuration
) {
    private val server: Javalin = Javalin.create()

    private val port =
        Key("port", intType)
    private val showJavalinBanner =
        Key("javalin.show-javalin-banner", booleanType)

    fun start() {
        server.config.showJavalinBanner = config[showJavalinBanner]
        server
            .get("/") { ctx ->
                ctx.render("home.peb")
            }
            .start(config[port])
    }

    fun stop() {
        server.stop()
    }
}

fun main(args: Array<String>) {
    val config: Configuration = EnvironmentVariables() overriding
            fromOptionalFile(File("./application.properties"))

    val app = App(config)

    shutdownHook {
        app.stop()
    }

    app.start()
}

private fun shutdownHook(shutdownCallback: () -> Unit) {
    Runtime.getRuntime().addShutdownHook(Thread(shutdownCallback))
}
